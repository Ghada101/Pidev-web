{% extends 'Frontoffice/basefront.html.twig' %}
{% block title %}Agency{% endblock %}
{% block body %}

    <div class="popular_places_area" style="margin-left: 50px">
        <div class="row">
            <div class="col-lg-3">
                <div class="filter_result_wrap">
                    <h3>Filter Result</h3>
                    <div class="filter_bordered">
                        <div class="filter_inner">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="single_select">
                                        <select>
                                            <option data-display="Country">Country</option>
                                            <option value="1">Africa</option>
                                            <option value="2">canada</option>
                                            <option value="4">USA</option>
                                        </select>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-8" style="margin-left: 150px">
                <div class="row" id="agencyHolder">

                </div>
            </div>

        </div>
        <div class="navigation">
            <nav class="blog-pagination justify-content-center d-flex">
                <ul class="pagination" id="navigationPaginated">
                </ul>
            </nav>
        </div>
    </div>
    </div>

    <script>
        var pageNumber = 1;
        const agencyHolder = document.getElementById('agencyHolder');
        const searchField = document.getElementById('seachBarAgency');
        const paginated = document.getElementById('navigationPaginated');

        console.log(searchField.value);

        function getAgencies(e, pageNumber = 1) {
            const name = searchField.value
            const PATH = name ? "/agency/search/" + name + "/" + pageNumber : "/agency/SearchAll/" + pageNumber;
            fetch(PATH, {
                method: 'GET',
            }).then(res => res.json()).then((data) => {
                agencyHolder.innerHTML = "";
                data.forEach(agency => {
                    if (typeof (agency) !== "object") {
                        paginated.innerHTML = "";
                        for (let i = 1; i <= agency; i++) {
                            paginated.innerHTML += `<li class="page-item"><a class="page-link" href="#" onclick="getAgencies(null,${i})">${i}</a></li>`;
                        }
                    } else {
                        agencyHolder.innerHTML += `<div class="col-lg-5">
                    <div class="col-lg-10 col-md-15">
                        <div class="single_place">
                            <div class="thumb">
                                <img src="/upload/images/${agency.imageagency}" alt="" />
                                <a href="#" class="prise">${agency.numberofavailablecars}</a>
                            </div>
                            <div class="place_info">
                                <a href="/car/front/${agency.idAgency}"><h3>${agency.nameagency}</h3></a>
                                <p>${agency.agencyphonenumber}</p>
                                <p>${agency.agencylocation}</p>
                                <div class="rating_days d-flex justify-content-between" style="padding-left: 290px">
                                    <div class="form-row">
                                        <p>${agency.nbrlike}</p>
                                        <a href="/agencylove/new/${agency.idAgency}">
                                        <img src="/img/Heart/heartLike.png" style="height: 30px">
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>`
                    }
                })
            }).catch((err) => console.log(err))
        }
        getAgencies(null)
        searchField.addEventListener('change', getAgencies)
    </script>
<script>
    var botmanWidget = {
        frameEndpoint: '{{ path("chatframe") }}',
        chatServer: '{{ path("msg") }}',
        introMessage: 'Well, hello customer\n i am AllInTravel assistant , What can I do for you?',
        title: 'My Chatbot',
        mainColor: '#DC143C',
        bubbleBackground: '#DC143C',
        aboutText: ''
    };
</script>
<script src='https://cdn.jsdelivr.net/npm/botman-web-widget@0/build/js/widget.js'></script>

{% endblock %}
